name: CI - Build Verification

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-and-test:
    name: Build Docker Containers
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create .env file
        run: |
          touch .env
          echo "POSTGRES_USER=ci_test" >> .env
          echo "POSTGRES_PASSWORD=ci_test" >> .env
          echo "POSTGRES_DB=worduel_db" >> .env
          echo "DB_HOST=db" >> .env
          echo "DB_PORT=5432" >> .env
          echo "BACKEND_PORT=3000" >> .env
          echo "FRONTEND_PORT=80" >> .env
          echo "ADMINER_PORT=8080" >> .env
          echo "JWT_SECRET=a_very_important_secret" >> .env
          cat .env # Just for CI debugging

      - name: Build with Docker Compose
        run: docker compose build
